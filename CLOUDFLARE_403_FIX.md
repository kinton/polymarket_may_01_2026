# Cloudflare 403 Error - –†–µ—à–µ–Ω–∏–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `post_order()` –ø–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É:
```
PolyApiException[status_code=403, error_message=<!DOCTYPE html>...Cloudflare...]
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–û—à–∏–±–∫–∞ **–ù–ï –≤ –∫–æ–¥–µ** - —ç—Ç–æ Cloudflare –±–ª–æ–∫–∏—Ä—É–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ `clob.polymarket.com`.

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ `create_order()` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ `get_server_time()` - –ø—Ä–æ—Å—Ç—ã–µ GET –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç  
- ‚úÖ API credentials –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Precision –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (maker=2dp, taker=4dp)

### –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è:
- ‚ùå `post_order()` - POST –∑–∞–ø—Ä–æ—Å —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –æ—Ä–¥–µ—Ä–æ–º

## –ü—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Cloudflare

1. **Rate Limiting** (–Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ)
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≤–∞—à–µ–≥–æ IP –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
   - WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è + polling + –ø–æ–ø—ã—Ç–∫–∏ post_order
   - Cloudflare –¥—É–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –±–æ—Ç/DDoS –∞—Ç–∞–∫–∞

2. **User-Agent Detection**
   - `py-clob-client` –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π User-Agent
   - Cloudflare –±–ª–æ–∫–∏—Ä—É–µ—Ç "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ" –∫–ª–∏–µ–Ω—Ç—ã

3. **Geographic Restrictions**
   - –í–∞—à IP –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–º" —Ä–µ–≥–∏–æ–Ω–µ
   - VPN/proxy detection

## –†–µ—à–µ–Ω–∏—è

### 1. –ü–æ–¥–æ–∂–¥–∞—Ç—å (Rate Limit Cooldown)
```bash
# –ü–æ–¥–æ–∂–¥–∏ 10-15 –º–∏–Ω—É—Ç, –∑–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞
sleep 900  # 15 –º–∏–Ω—É—Ç
uv run python main.py --live --once
```

### 2. –°–º–µ–Ω–∏—Ç—å —Å–µ—Ç—å/IP
```bash
# –í–∞—Ä–∏–∞–Ω—Ç—ã:
# - –ü–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–π hotspot (–¥—Ä—É–≥–æ–π IP)
# - –ò—Å–ø–æ–ª—å–∑—É–π VPN (–Ω–æ –Ω–µ –¥–µ—à–µ–≤—ã–π, Cloudflare –∏—Ö –¥–µ—Ç–µ–∫—Ç–∏—Ç)
# - –ü–æ–ø—Ä–æ–±—É–π —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞/—Å–µ—Ç–∏
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É
```bash
# –í–æ–∑–º–æ–∂–Ω–æ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã headers
uv pip install -U py-clob-client
```

### 4. Approve Allowance (–µ—Å–ª–∏ –Ω–µ –¥–µ–ª–∞–ª)
```bash
# –£–±–µ–¥–∏—Å—å, —á—Ç–æ approved USDC –¥–ª—è trading
uv run python approve.py
```

### 5. –°–≤—è–∑–∞—Ç—å—Å—è —Å Polymarket Support
```
Email: support@polymarket.com
–¢–µ–º–∞: "403 Cloudflare error when posting orders via API"
–£–∫–∞–∂–∏: —Ç–≤–æ–π IP, timestamp –æ—à–∏–±–∫–∏, Cloudflare Ray ID –∏–∑ –ª–æ–≥–∞
```

## Workaround: –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `main.py`:

```python
# –£–≤–µ–ª–∏—á—å –∏–Ω—Ç–µ—Ä–≤–∞–ª polling
POLL_INTERVAL = 120  # –±—ã–ª–æ 90, —Å—Ç–∞–ª–æ 120 —Å–µ–∫—É–Ω–¥

# –£–º–µ–Ω—å—à–∏ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã trader'–∞ (–º–µ–Ω—å—à–µ WebSocket –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
TRADER_START_BUFFER = 120  # –±—ã–ª–æ 180, —Å—Ç–∞–ª–æ 120 —Å–µ–∫—É–Ω–¥ (2 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 3)
```

–≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API –∏ —Å–Ω–∏–∑–∏—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å rate limiting.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

1. **Polymarket Status**: https://status.polymarket.com
2. **Your IP**: `curl https://ifconfig.me` (–≤–∫–ª—é—á–∏ –≤ email –≤ support)
3. **Test Connection**:
   ```bash
   uv run python test_clob_connection.py
   ```

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

Polymarket –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Cloudflare –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç:
- DDoS –∞—Ç–∞–∫
- –°–∫—Ä–µ–π–ø–∏–Ω–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ (high-frequency bots)

–¢–≤–æ–π –±–æ—Ç –¥–µ–ª–∞–µ—Ç:
1. Continuous polling –∫–∞–∂–¥—ã–µ 90 —Å–µ–∫—É–Ω–¥
2. 2 WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è per market
3. –ü–æ–ø—ã—Ç–∫–∏ post_order –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ–∫—É–Ω–¥—ã

–î–ª—è Cloudflare —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π bot ü§ñ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:
- –ü–æ–¥–æ–∂–¥–∏ 15 –º–∏–Ω—É—Ç
- –°–º–µ–Ω–∏ IP (mobile hotspot)
- –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:
- –£–º–µ–Ω—å—à–∏ poll interval (120+ —Å–µ–∫—É–Ω–¥)
- –î–æ–±–∞–≤—å random jitter –∫ timing
- –†–∞—Å—Å–º–æ—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ Polymarket
- –°–≤—è–∂–∏—Å—å —Å Polymarket –¥–ª—è API whitelist

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Manual Trading UI

–ï—Å–ª–∏ API –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è, –º–æ–∂–µ—à—å:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç –≤ dry-run mode
2. –û–Ω –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–≥–¥–∞ –ø–æ–∫—É–ø–∞—Ç—å
3. –¢—ã –≤—Ä—É—á–Ω—É—é –¥–µ–ª–∞–µ—à—å order —á–µ—Ä–µ–∑ polymarket.com

```bash
# Dry run —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
uv run python main.py  # –±–µ–∑ --live —Ñ–ª–∞–≥–∞
```

---

**TL;DR**: –≠—Ç–æ Cloudflare rate limiting, –Ω–µ –±–∞–≥ –≤ –∫–æ–¥–µ. –ü–æ–¥–æ–∂–¥–∏ 15 –º–∏–Ω—É—Ç –∏–ª–∏ —Å–º–µ–Ω–∏ IP.
